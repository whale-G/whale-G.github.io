---
title: "差分数组原理以及构造方式"
date: 2025-10-30
categories: [知识分享]
tags: [数据结构&算法]
math: true
---

## 差分数组

长度为`n`的数组`a[0..n-1]`的差分数组`d[0..n-1]`为：
$$
\begin{equation}
  d[i] = 
  \left\{
  \begin{array}{lc}
    a[i], & \quad i = 0 \\
    a[i]-a[i-1], & \quad i > 0
  \end{array}
  \right.
\end{equation}
$$
例如当`a=[1,2,3,2,1]`时，差分数组`d=[1,1,1,-1,-1]`。

---

差分数组的获取是前缀和数组的获取的逆运算，即对差分数组进行前缀和操作可以得到原数组。

## 差分数组的构造

除了定义法中的构造方式，还有一种巧妙的构造方式。在分享这个方式之前，我们先来看一个应用场景：原数组为`a[0..n-1]`，对给定区间`[L, R]`中的所有元素同时加上`C`（`L`和`R`的取值一定合法）。

我们可以先通过**定义法**构造出原数组`a`的差分数组`d`。根据差分数组的性质，我们很容易知道以下两步的影响：

1. 如果在差分数组中对下标`L`的元素加上`C`，那么通过求前缀和操作还原的数组中区间`[L, n-1]`的元素均会相较原数组`a`加上`C`。
2. 同理，如果在差分数组中对下标为`R+1`的元素减去`C`，那么获取的“原数组”中区间`[R+1, n-1]`的元素均会相较1中获取的“原数组”减去`C`，即这部分区间的元素抵消了1中的操作。

小结一下，即通过对差分数组中下标`L`的元素加上`C`，对下标`R+1`的元素减去`C`这两个操作实现了对原数组`a`中区间`[L, R]`所有元素加上`C`。这样做使得原本$O(n)$的操作优化为了$O(1)$。

---

通过这样一个场景的引入，我们可以获取一种巧妙的构造差分数组的方式。即原数组`a[0..n-1]`，我们先构造一个元素值均为0的数组，在每一个`[i, i]`区间都加上`a[i]`，那么得到的数组，就是原数组`a`的差分数组。用表格表示如下：

| 操作   | [0, 0] | [1, 1]      | [2, 2]      | ...  | [n-1, n-1]      |
| ------ | ------ | ----------- | ----------- | ---- | --------------- |
| 元素值 | a[0]   | a[1] - a[0] | a[2] - a[1] | ...  | a[n-1] - a[n-2] |
| 下标   | 0      | 1           | 2           | ...  | n-1             |

可以看出，这样构造的差分数组与定义法构造的结果无二，但是更为便捷。

## 练习

[力扣No.1526](https://leetcode.cn/problems/minimum-number-of-increments-on-subarrays-to-form-a-target-array/solutions/371326/xing-cheng-mu-biao-shu-zu-de-zi-shu-zu-zui-shao-ze/?envType=daily-question&envId=2025-10-30)

[AcWingNo.797](https://www.acwing.com/problem/content/799/)